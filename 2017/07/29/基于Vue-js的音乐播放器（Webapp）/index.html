<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="A contented mind is a perpetual feast."><title>基于Vue.js的音乐播放器（Webapp） | WaterBlog</title><link rel="stylesheet" type="text/css" href="/css/style.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">基于Vue.js的音乐播放器（Webapp）</h1><a id="logo" href="/.">WaterBlog</a><p class="description">WaterGayGay的博客</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/collection/"><i class="fa fa-bookmark"> 收藏</i></a><a href="/history/"><i class="fa fa-book"> 历史</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">基于Vue.js的音乐播放器（Webapp）</h1><div class="post-meta">Jul 29, 2017<span> | </span><span class="category"><a href="/categories/FontEnd/">FontEnd</a></span></div><div class="post-content"><!-- ![](https://oc1gyfe6q.qnssl.com/17-7-29/95678226.jpg) -->
<h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>项目是基于Vue.js，成品是一个移动端的音乐播放器，来源于imooc的实战课程。自己动手实践并加以修改拓展。<br>项目的大致流程是Vue-cli构建开发环境，分析需求，设计构思，规划目录结构，开始编码。<br><a id="more"></a><br><!-- more --></p>
<h4 id="视图层"><a href="#视图层" class="headerlink" title="视图层"></a>视图层</h4><blockquote>
<ul>
<li>推荐页</li>
<li>歌手页<ul>
<li>歌手详情</li>
</ul>
</li>
<li>歌曲排行榜<ul>
<li>排行榜详情</li>
</ul>
</li>
<li>搜索页</li>
<li>用户中心</li>
</ul>
</blockquote>
<h4 id="数据来源"><a href="#数据来源" class="headerlink" title="数据来源"></a>数据来源</h4><p>所有数据都来自于QQ音乐，抓取自QQ的接口，大部分接口都是JSONP，抓取比较容易，其中一些接口限制了<code>host</code>，不能直接抓取，采用的方法是用<code>axios</code>代理，设置<code>header</code>，以此绕过<code>host</code>的限制。<br>PS：具体代码请看<code>prod.server.js</code>文件</p>
<h4 id="技术栈"><a href="#技术栈" class="headerlink" title="技术栈"></a>技术栈</h4><blockquote>
<p>Vue<br>Vuex<br>Vue-Router<br>Vue-cli<br>Stylus<br>Axios<br>ESlint<br>Better-scroll</p>
</blockquote>
<h4 id="src目录结构"><a href="#src目录结构" class="headerlink" title="src目录结构"></a>src目录结构</h4><p><img src="http://upload-images.jianshu.io/upload_images/3017671-0d73dfcecd68f86c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3 id="难点"><a href="#难点" class="headerlink" title="难点"></a>难点</h3><h4 id="player组件"><a href="#player组件" class="headerlink" title="player组件"></a>player组件</h4><p>讲一讲<code>player</code>    播放器组件，播放器组件可谓是整个项目的核心，当然数据处理和用户体验方面也是不简单的（逃。<br>播放器是全局组件，放在<code>App.vue</code>下面，通过<code>Vuex</code>传递数据，触发<code>action</code>提交<code>mutation</code>，从而使播放器开始工作。当然，其中的数据交互说复杂也不是很复杂，就是要花多点时间理解，<code>player</code>组件由多个基础组件构成，具体请看项目代码，下面上图<br><img src="http://upload-images.jianshu.io/upload_images/3017671-58dbbfd92e63fd2c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>为了防止切换歌曲时点击速度过快导致歌曲播放错误，使用了<code>audio</code>的<code>onplay</code>API，结合<code>Vuex</code>获取到数据，判断当前歌曲数据请求到才可以切换下一首歌曲，判断函数如下<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ready() &#123;</div><div class="line">  <span class="keyword">this</span>.songReady = <span class="literal">true</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h4 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h4><p>通过调用QQ音乐的JSONP接口，获取的数据并不能直接拿来用，需要做进一步的规格化，达到我们使用的要求，所以在这方面单独封装了一个<code>class</code>来处理这方面的数据，具体请看<code>src/common/js/song.js</code></p>
<p>在请求JSONP的时候，用到了一个JSONP库，这个库代码十分简短，只有几十行，有兴趣的同学可以<a href="https://github.com/webmodules/jsonp" target="_blank" rel="external">学习</a>下。</p>
<p>使用时，就是将请求的参数拼接在请求url上，然后调用这个库的<code>jsonp</code>方法。所以，在此封装了两个函数，一个是将参数拼接在url上，另一个是将库里面的<code>jsonp</code>方法Promise化，方便我们使用，具体请查看<code>src/common/js/jsonp.js</code>。</p>
<p>将请求的数据格式化后再通过<code>Vuex</code>传递，组件间共享，实现歌曲的播放切换等。</p>
<h4 id="交互体验"><a href="#交互体验" class="headerlink" title="交互体验"></a>交互体验</h4><p>该项目的很多地方都涉及到滚动，包括下拉滚动，下拉滚动刷新等。这里面用到了一个库(<code>better-scroll</code>)，来实现所有涉及到的滚动，建议学习下它的<a href="https://github.com/ustbhuangyi/better-scroll" target="_blank" rel="external">API</a>。</p>
<p>其他动画包括了<code>Vue</code>的<code>transition</code>动画，路由之间切换时的简单动画，播放器打开时的动画，这个地方比较难，也比较好玩。</p>
<p>打开页面时的加载Loading效果，其实就是一个Loading组件，也比较简单。</p>
<p>为了减少流量，图片加载使用了懒加载的方式，滚动时再加载真实的图片。<br>具体效果请自身体验：）</p>
<h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3><p><img src="http://upload-images.jianshu.io/upload_images/3017671-1e68275dfb64a26a.jpg?imageMogr2/auto-orient/strip" alt=""><br><img src="http://upload-images.jianshu.io/upload_images/3017671-df2bc070213bd1ec.jpg?imageMogr2/auto-orient/strip" alt=""><br><img src="http://upload-images.jianshu.io/upload_images/3017671-ca76b7c4ca052f57.jpg?imageMogr2/auto-orient/strip" alt=""><br><img src="http://upload-images.jianshu.io/upload_images/3017671-09583fbd757c77f1.jpg?imageMogr2/auto-orient/strip" alt=""></p>
<h3 id="构建"><a href="#构建" class="headerlink" title="构建"></a>构建</h3><h4 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># install dependencies</span></div><div class="line">npm install</div><div class="line"></div><div class="line"><span class="comment"># serve with hot reload at localhost:8080</span></div><div class="line">npm run dev</div><div class="line"></div><div class="line"><span class="comment"># run e2e tests</span></div><div class="line">npm run e2e</div><div class="line"></div><div class="line"><span class="comment"># run all tests</span></div><div class="line">npm <span class="built_in">test</span></div></pre></td></tr></table></figure>
<h4 id="生产环境"><a href="#生产环境" class="headerlink" title="生产环境"></a>生产环境</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># build for production with minification</span></div><div class="line">npm run build</div><div class="line"><span class="comment"># run</span></div><div class="line">node prod.server.js</div></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>通过学习该项目，自己收获了许多，实践中也遇到了大大小小许多问题，通过断点调试等最终解决了，对我来说无疑是最大的鼓励，也希望能与大家一起学习。<br>项目地址：<a href="https://github.com/k-water/vue-music" target="_blank" rel="external">https://github.com/k-water/vue-music</a><br>喜欢的求个star(^_^)ノ<br>完 ：）</p>
</div><div class="tags"><a href="/tags/HTML5/">HTML5</a><a href="/tags/Vue/">Vue</a></div><div class="post-nav"><a href="/2017/08/01/媒体查询/" class="pre">媒体查询</a><a href="/2017/06/20/项目总结/" class="next">项目总结</a></div><div id="container"></div><link rel="stylesheet" href="/css/default.css?v=1.0.0"><script src="/js/gitment.browser.js?v=1.0.0"></script><script>var gitment = new Gitment({
  owner: 'k-water',
  repo: 'k-water.github.io',
  oauth: {
    client_id: 'b80d9a577bec58f5cd74',
    client_secret: 'bb14317e485db9a408465da9eac80af12e340ad9',
  },
})
gitment.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://waterlin.cn"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/more/"><!--more--></a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/BackEnd/">BackEnd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/FontEnd/">FontEnd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Server/">Server</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tool/">Tool</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/node/" style="font-size: 15px;">node</a> <a href="/tags/HTML5/" style="font-size: 15px;">HTML5</a> <a href="/tags/jQuery/" style="font-size: 15px;">jQuery</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/blog/" style="font-size: 15px;">blog</a> <a href="/tags/Algorithm/" style="font-size: 15px;">Algorithm</a> <a href="/tags/Data-struct/" style="font-size: 15px;">Data struct</a> <a href="/tags/BFC/" style="font-size: 15px;">BFC</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/Sass/" style="font-size: 15px;">Sass</a> <a href="/tags/Browser/" style="font-size: 15px;">Browser</a> <a href="/tags/HTTP/" style="font-size: 15px;">HTTP</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/CSS/" style="font-size: 15px;">CSS</a> <a href="/tags/ES6/" style="font-size: 15px;">ES6</a> <a href="/tags/CSS3/" style="font-size: 15px;">CSS3</a> <a href="/tags/Blog/" style="font-size: 15px;">Blog</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/VSCode/" style="font-size: 15px;">VSCode</a> <a href="/tags/Vue/" style="font-size: 15px;">Vue</a> <a href="/tags/转载/" style="font-size: 15px;">转载</a> <a href="/tags/服务器/" style="font-size: 15px;">服务器</a> <a href="/tags/IFE/" style="font-size: 15px;">IFE</a> <a href="/tags/MongoDB/" style="font-size: 15px;">MongoDB</a> <a href="/tags/汇编/" style="font-size: 15px;">汇编</a> <a href="/tags/RegExp/" style="font-size: 15px;">RegExp</a> <a href="/tags/Electron/" style="font-size: 15px;">Electron</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/15/underscore源码学习（一）/">underscore源码学习（一）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/22/JavaScript-Sorting-Algorithm/">JavaScript Sorting Algorithm</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/18/在Vue中使用第三方库/">在Vue中使用第三方库</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/13/基于vue-electron的项目梳理总结/">基于vue-electron的项目梳理总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/01/媒体查询/">媒体查询</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/29/基于Vue-js的音乐播放器（Webapp）/">基于Vue.js的音乐播放器（Webapp）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/20/项目总结/">项目总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/11/常用正则表达式/">常用正则表达式</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/30/转载-JavaScript函数声明提升/">JavaScript函数声明提升</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/19/转载-浅析前端工程化/">浅析前端工程化</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://blog.lxstart.net/" title="x-cold" target="_blank">x-cold</a><ul></ul><a href="http://www.cnblogs.com/liuweimingcprogram" title="SCAU_L" target="_blank">SCAU_L</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2016-2017 <a href="/." rel="nofollow">WaterBlog.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" color="0,0,0" opacity="0.5" zIndex="-2" count="50" src="//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script><script type="text/javascript" src="/js/background-canvas.js?v=1.0.0"></script></div></body></html>