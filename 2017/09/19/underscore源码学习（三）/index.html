<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="A contented mind is a perpetual feast."><title>underscore源码学习（三） | WaterBlog</title><link rel="stylesheet" type="text/css" href="/css/style.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">underscore源码学习（三）</h1><a id="logo" href="/.">WaterBlog</a><p class="description">WaterGayGay的博客</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/collection/"><i class="fa fa-bookmark"> 收藏</i></a><a href="/history/"><i class="fa fa-book"> 历史</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">underscore源码学习（三）</h1><div class="post-meta">Sep 19, 2017</div><div class="post-content"><p>上一篇总结underscore中关于迭代集合的相关函数，这一次来看看underscore中的查找函数，对元素，字面量的查找。underscore中提供的查找函数有以下：</p>
<ul>
<li><code>_.indexOf</code></li>
<li><code>_.lastIndexOf</code></li>
<li><code>_.findIndex</code></li>
<li><code>_.findLastIndex</code></li>
<li><code>_.sortedIndex</code></li>
<li><code>_.find</code></li>
<li><code>_.findWhere</code></li>
<li><code>where</code><a id="more"></a>
<h3 id="indexOf的实现"><a href="#indexOf的实现" class="headerlink" title="_.indexOf的实现"></a>_.indexOf的实现</h3>在上一篇的结尾中，有一个<code>_.container</code>函数中用到<code>_.indexOf</code>这个查找函数。在underscore中<code>_.indexOf</code>同样是经过一个工厂函数<code>createIndexFinder</code>来实现的。</li>
</ul>
<h4 id="createIndexFinder"><a href="#createIndexFinder" class="headerlink" title="createIndexFinder"></a>createIndexFinder</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 创建一个查询某元素位置的工厂函数</div><div class="line"> * @param &#123;Number&#125; dir 查询方向 1 向左 -1 向右</div><div class="line"> * @param &#123;Function&#125; predicateFind </div><div class="line"> * @param &#123;Function&#125; sortedIndex </div><div class="line"> * @returns &#123;Function&#125;</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createIndexFinder</span>(<span class="params">dir, predicateFind, sortedIndex</span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">array, item, idx</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> i = <span class="number">0</span>,</div><div class="line">      length = getLength(array)</div><div class="line">    <span class="comment">// 如果设置了查询起点 且查询起点格式正确</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> idx == <span class="string">'number'</span>) &#123;</div><div class="line">      <span class="comment">// 校验查询起点</span></div><div class="line">      <span class="keyword">if</span> (dir &gt; <span class="number">0</span>) &#123;</div><div class="line">        i = idx &gt;= <span class="number">0</span> ? idx : <span class="built_in">Math</span>.max(idx + length, i)</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        length = idx &gt;= <span class="number">0</span> ? <span class="built_in">Math</span>.min(idx + <span class="number">1</span>, length) : idx + length + <span class="number">1</span></div><div class="line">      &#125;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sortedIndex &amp;&amp; idx &amp;&amp; length) &#123;</div><div class="line">      <span class="comment">// 传递sortedIndex的搜索</span></div><div class="line">      idx = sortedIndex(array, item)</div><div class="line">      <span class="keyword">return</span> array[idx] === item ? idx : <span class="number">-1</span></div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 如果待查找的不是数字 即(NaN===NaN, false)</span></div><div class="line">    <span class="keyword">if</span> (item !== item) &#123;</div><div class="line">      idx = predicateFind(slice.call(array, i, length), _.isNaN)</div><div class="line">      <span class="keyword">return</span> idx &gt;= <span class="number">0</span> ? idx + i : <span class="number">-1</span></div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 以上情况都不是 直接通过 === 查找</span></div><div class="line">    <span class="keyword">for</span> (idx = dir &gt; <span class="number">0</span> ? i : length - <span class="number">1</span>; idx &gt;= <span class="number">0</span> &amp;&amp; idx &lt; length; idx += dir) &#123;</div><div class="line">      <span class="keyword">if</span> (array[idx] === item) <span class="keyword">return</span> idx</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>通过<code>creareIndexFinder</code>函数，underscore提供了两个供查询的API<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">_.indexOf = createIndexFinder(<span class="number">1</span>, _.findIndex, _.sortedIndex)</div><div class="line">_.lastIndexOf = createIndexFinder(<span class="number">-1</span>, _.findLastIndex)</div></pre></td></tr></table></figure></p>
<p>可以看到，<code>_.findIndex</code>作为断言查找函数<code>_.sortedIndex</code>作为排序查找函数传入<code>createIndexFinder</code>函数中，最终构成了<code>_.indexOf</code>这个元素查找函数。</p>
<h4 id="findIndex"><a href="#findIndex" class="headerlink" title="_.findIndex"></a>_.findIndex</h4><p><code>_.findIndex</code>函数的也是通过一个工厂函数<code>createPredicateIndexFinder</code>实现的<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 位置查询函数</div><div class="line"> * @param &#123;Number&#125; dir 查询方向 1 正向 -1 逆向 </div><div class="line"> * @returns &#123;Function&#125;</div><div class="line"> * </div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createPredicateIndexFinder</span>(<span class="params">dir</span>) </span>&#123;</div><div class="line">  <span class="comment">/**</span></div><div class="line">   * @param array 待搜索数组</div><div class="line">   * @param predicate 真值检测函数</div><div class="line">   * @param context 执行上下文</div><div class="line">   */</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">array, predicate, context</span>) </span>&#123;</div><div class="line">    predicate = cb(predicate, context)</div><div class="line">    <span class="keyword">var</span> length = getLength(array)</div><div class="line">    <span class="keyword">var</span> index = dir &gt; <span class="number">0</span> ? <span class="number">0</span> : length - <span class="number">1</span></div><div class="line">    <span class="keyword">for</span> (; index &gt;= <span class="number">0</span> &amp;&amp; index &lt; length; index += dir) &#123;</div><div class="line">      <span class="keyword">if</span> (predicate(array[index], index, array)) <span class="keyword">return</span> index</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">-1</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>看起来是不是十分熟悉，underscore通过同样的套路返回了一个位置搜索函数，返回待查找元素的位置，同样传入的断言函数<code>predicate</code>也通过<code>cb</code>函数进行回调优化。<br>underscore利用此工厂函数提供两个对外的API<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">_.findIndex = createPredicateIndexFinder(<span class="number">1</span>)</div><div class="line">_.findLastIndex = createPredicateIndexFinder(<span class="number">-1</span>)</div></pre></td></tr></table></figure></p>
<p>看下使用用例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> res = _.findIndex([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>], funciton(value) &#123;</div><div class="line"> <span class="keyword">return</span> value === <span class="number">1</span></div><div class="line">&#125;)</div><div class="line"><span class="comment">// =&gt; 0</span></div></pre></td></tr></table></figure></p>
<h4 id="sortedIndex"><a href="#sortedIndex" class="headerlink" title="_.sortedIndex"></a>_.sortedIndex</h4><p><code>_.sortedIndex</code>采用二分查找的方法查找元素或对象的位置，通过向<code>cb</code>函数传入的<code>iteratee</code>参数确定回调函数。注意，使用二分查找的时候默认查找的数组有序<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 二分查找返回obj在array中的位置</div><div class="line"> * @param array 已排序数组</div><div class="line"> * @param obj 待确定位置对象</div><div class="line"> * @param iteratee 位置确定标准</div><div class="line"> * @param context 执行上下文</div><div class="line"> */</div><div class="line">_.sortedIndex = <span class="function"><span class="keyword">function</span>(<span class="params">array, obj, iteratee, context</span>) </span>&#123;</div><div class="line">  iteratee = cb(iteratee, context, <span class="number">1</span>)</div><div class="line">  <span class="keyword">var</span> value = iteratee(obj)</div><div class="line">  <span class="keyword">var</span> low = <span class="number">0</span>, high = getLength(array)</div><div class="line">  <span class="keyword">while</span>(low &lt; high) &#123;</div><div class="line">    <span class="keyword">var</span> mid = <span class="built_in">Math</span>.floor((low + high) / <span class="number">2</span>)</div><div class="line">    <span class="keyword">if</span>(iteratee(array[mid]) &lt; mid) &#123;</div><div class="line">      low = mid + <span class="number">1</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      high = mid</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> low</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>至此，我们来整理一下<code>_.indexOf</code>函数实现的思路</p>
<ul>
<li>首先通过工厂函数<code>createIndexFinder(1, _.findIndex, _.sortedIndex)</code>创建<code>_.indexOf</code></li>
<li>继续深入了解<code>_.findIndex</code>的实现<ul>
<li><code>_.findIndex</code>通过工厂函数<code>createPredicateIndexFinder(1)</code>实现</li>
</ul>
</li>
<li>了解<code>_.sortedIndex</code>的实现(二分查找)</li>
</ul>
<p>使用用例<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> arr = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">400</span>), i = <span class="number">0</span></div><div class="line"><span class="built_in">Array</span>.from(arr, item =&gt; i++)</div><div class="line">_.indexOf(arr, <span class="number">1</span>)</div><div class="line"><span class="comment">// =&gt; 1</span></div></pre></td></tr></table></figure></p>
<h3 id="where的实现"><a href="#where的实现" class="headerlink" title="_.where的实现"></a>_.where的实现</h3><p><code>_.where</code>函数的作用类似于<code>SQL</code>中的查询条件，对于某个对象集合，返回满足<code>where</code>条件的对象。<br>underscore中<code>_.where</code>函数的实现：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * @param obj 待迭代对象</div><div class="line"> * @param attrs where条件对象</div><div class="line"> */</div><div class="line">_.where = <span class="function"><span class="keyword">function</span>(<span class="params">obj, attrs</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> _.filter(obj, _.mathcer(attrs))</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>可以看到，<code>_.where</code>函数只有一行，非常简短，其内部调用了underscore中的<code>_.filter</code>函数，并将<code>_.matcher</code>函数作为<code>._filter</code>函数的真值检测函数传入其中，在上一篇的学习中我们知道，<code>_filter</code>函数的功能是通过真值检测函数<code>predicate</code>过滤对象，保存通过检测的元素。<br>为了弄清楚<code>_.where</code>的实现，需要了解<code>_.mather</code>函数的实现。</p>
<h4 id="matcher"><a href="#matcher" class="headerlink" title="_.matcher"></a>_.matcher</h4><p><code>_.matcher</code>函数的功能是返回一个属性检测函数，检测某个对象是否具有指定属性，如果有则返回<code>true</code>，反之则是<code>false</code>。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * @param attrs 属性集合</div><div class="line"> */</div><div class="line">_.matcher = _.matches =<span class="function"><span class="keyword">function</span>(<span class="params">attrs</span>) </span>&#123;</div><div class="line">  attrs = _.extendOwn(&#123;&#125;, attrs)</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> _.isMatch(obj, attrs)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>可以看到，<code>_.matcher</code>函数通过闭包返回了另一个函数，先不管其中调用的<code>_.extendOwn</code>和<code>_.isMatch</code>函数，先看看<code>_.matcher</code>函数的使用例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> name = _.matcher(&#123;name: <span class="string">'water'</span>&#125;) <span class="comment">//返回闭包函数</span></div><div class="line"><span class="keyword">var</span> person = &#123;</div><div class="line">  name: <span class="string">'water'</span>,</div><div class="line">  age: <span class="string">'20'</span></div><div class="line">&#125;</div><div class="line">name(person) <span class="comment">// 传入检测对象 返回结果</span></div><div class="line"><span class="comment">// =&gt; true</span></div></pre></td></tr></table></figure></p>
<h4 id="extendOwn"><a href="#extendOwn" class="headerlink" title="_.extendOwn"></a>_.extendOwn</h4><p><code>_.extendOwn</code>和<code>_.extend</code>函数是通过underscore中的一个工厂函数<code>createAssigner</code>实现的。<code>_.extendOwn</code>和<code>_.extend</code>函数的基本功能是扩展一个对象的属性，但其不同点是<code>_.extend</code>将继承各个对象的属性 ，包括原型链上非自身的属性，而<code>_.extendOwn</code>则没有，它继承目标对象自身的属性。<br><code>createAssigner</code>的实现：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">  <span class="comment">/**</span></div><div class="line">   * 创建分配器函数 分配到某个对象</div><div class="line">   * @param &#123;Function&#125; keysFunc </div><div class="line">   * @param &#123;Boolean&#125; undefinedOnly </div><div class="line">   * 默认为fasle 相同属性的值会被覆盖</div><div class="line">   * 如果设置为true 则只会为obj分配其未定义的属性</div><div class="line">   */</div><div class="line"><span class="keyword">var</span> createAssigner = <span class="function"><span class="keyword">function</span> (<span class="params">keysFunc, undefinedOnly</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> length = <span class="built_in">arguments</span>.length</div><div class="line">    <span class="keyword">if</span> (length &lt; <span class="number">2</span> || obj == <span class="literal">null</span>) <span class="keyword">return</span> obj</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> index = <span class="number">1</span>; index &lt; length; index++) &#123;</div><div class="line">      <span class="keyword">var</span> source = <span class="built_in">arguments</span>[index],</div><div class="line">        keys = keysFunc(source),</div><div class="line">        l = keys.length</div><div class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; l; i++) &#123;</div><div class="line">        <span class="keyword">var</span> key = keys[i]</div><div class="line">        <span class="comment">// 若没有传入undefinedOnly，则会覆盖原来key的value</span></div><div class="line">        <span class="comment">// 如果有传入undefinedOnly，则只会设置原来为undefined的属性</span></div><div class="line">        <span class="keyword">if</span> (!undefinedOnly || obj[key] === <span class="keyword">void</span> <span class="number">0</span>) &#123;</div><div class="line">          obj[key] = source[key]</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> obj</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>通过<code>createAssigner</code>生成的两个API<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">_.extend = createAssigner(_.allKeys)</div><div class="line">_.extendOwn = _.assign = createAssigner(_.keys)</div></pre></td></tr></table></figure></p>
<p>在这里<code>_.allKeys</code>和<code>_.keys</code>作为参数<code>keysFunc</code>传入，从而实现了预期的功能，<code>_.allKeys</code>和<code>_.keys</code>函数的功能都是获取对象的keys值，区别就是<code>_.allKeys</code>获取的是对象的所有属性，包括不属于自身的属性。这也解释了<code>_.extend</code>和<code>_.extendOwn</code>的区别。</p>
<h4 id="isMatch"><a href="#isMatch" class="headerlink" title="_.isMatch"></a>_.isMatch</h4><p><code>_.isMatch</code>函数的功能是检测一个键值对是否在一个对象中，返回Boolean值。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * @param &#123;object&#125; object</div><div class="line"> * @param &#123;object&#125; attrs</div><div class="line"> */</div><div class="line">_.isMatch = <span class="function"><span class="keyword">function</span> (<span class="params">object, attrs</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> keys = _.keys(attrs),</div><div class="line">    length = keys.length</div><div class="line">  <span class="keyword">if</span> (object == <span class="literal">null</span>) <span class="keyword">return</span> !length</div><div class="line">  <span class="keyword">var</span> obj = <span class="built_in">Object</span>(object)</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</div><div class="line">    <span class="keyword">var</span> key = keys[i]</div><div class="line">    <span class="keyword">if</span> (attrs[key] !== obj[key] || !(key <span class="keyword">in</span> obj)) <span class="keyword">return</span> <span class="literal">false</span></div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="literal">true</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>至此，梳理一下<code>_.where</code>函数的实现，<code>_.where</code>函数主要调用了<code>_.filter</code>函数进行筛选，内部<code>_.matcher</code>函数的实现比较繁琐，一步步下来，解释<code>_.extendOwn</code>和<code>_.isMacth</code>的实现，先从外部到内部，理解了内部实现，再从内部到外部理解，脑海中模拟函数的调用实现，基本能理解。</p>
<p><code>_.where</code>函数使用例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> person = [</div><div class="line">  &#123;name: <span class="string">'water'</span>, age: <span class="number">18</span>, sex: <span class="string">'male'</span>&#125;,</div><div class="line">  &#123;name: <span class="string">'lzb'</span>, age: <span class="number">18</span>, sex: <span class="string">'male'</span>&#125;</div><div class="line">]</div><div class="line"><span class="keyword">var</span> ret = _.where(person, &#123;age: <span class="number">18</span>, sex: <span class="string">'male'</span>&#125;)</div><div class="line"><span class="comment">// =&gt; [</span></div><div class="line"><span class="comment">//  &#123;name: 'water', age: 18, sex: 'male'&#125;,</span></div><div class="line"><span class="comment">//  &#123;name: 'lzb', age: 18, sex: 'male'&#125;</span></div><div class="line"><span class="comment">// ]</span></div></pre></td></tr></table></figure></p>
<h3 id="findWhere"><a href="#findWhere" class="headerlink" title="_.findWhere"></a>_.findWhere</h3><p><code>_.findWhere</code>跟<code>_.where</code>函数功能类似，<code>_.findWhere</code>返回的是对象中跟第一个跟参数<code>attrs</code>匹配的元素。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * @param obj 对象集合</div><div class="line"> * @param attrs where条件对象</div><div class="line"> */</div><div class="line">_.findWhere = <span class="function"><span class="keyword">function</span> (<span class="params">obj, attrs</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> _.find(obj, _.matcher(attrs))</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="find"><a href="#find" class="headerlink" title="_.find"></a>_.find</h4><p><code>_.find</code>函数根据传入的真值检测函数，在集合内搜索，返回对应的值。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * @param obj 待查询对象</div><div class="line"> * @param predicate 真值检测函数</div><div class="line"> * @param context 执行上小文</div><div class="line"> * @example </div><div class="line"> * var even = _.find([1, 2, 3, 4, 5, 6], function(num)&#123; return num % 2 == 0; &#125;);</div><div class="line"> * =&gt; 2</div><div class="line"> */</div><div class="line">_.find = _.detect = <span class="function"><span class="keyword">function</span> (<span class="params">obj, predicate, context</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> key;</div><div class="line">  <span class="comment">// 如果是数组 根据下标寻找</span></div><div class="line">  <span class="comment">// 如果是对象 根据key值寻找</span></div><div class="line">  <span class="keyword">if</span> (isArrayLike(obj)) &#123;</div><div class="line">    key = _.findIndex(obj, predicate, context)</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    key = _.findKey(obj, predicate, context)</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">if</span> (key !== <span class="keyword">void</span> <span class="number">0</span> &amp;&amp; key !== <span class="number">-1</span>) <span class="keyword">return</span> obj[key]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>_.findWhere</code>使用例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> person = [</div><div class="line">  &#123;name: <span class="string">'water'</span>, age: <span class="number">20</span>, sex: <span class="string">'male'</span>&#125;,</div><div class="line">  &#123;name: <span class="string">'lzb'</span>, age: <span class="number">18</span>, sex: <span class="string">'male'</span>&#125;</div><div class="line">]</div><div class="line"></div><div class="line"><span class="keyword">var</span> ret = _.findWhere(person, &#123;age: <span class="number">20</span>, sex: <span class="string">'male'</span>&#125;)</div><div class="line"><span class="comment">// =&gt; &#123; name: 'lzb', age: 18, sex: 'male' &#125;</span></div></pre></td></tr></table></figure></p>
</div><div class="tags"><a href="/tags/JavaScript/">JavaScript</a></div><div class="post-nav"><a href="/2017/09/22/underscore源码学习（四）/" class="pre">underscore源码学习（四）</a><a href="/2017/09/17/underscore源码学习（二）/" class="next">underscore源码学习（二）</a></div><div id="container"></div><link rel="stylesheet" href="/css/default.css?v=1.0.0"><script src="/js/gitment.browser.js?v=1.0.0"></script><script>var gitment = new Gitment({
  owner: 'k-water',
  repo: 'k-water.github.io',
  oauth: {
    client_id: 'b80d9a577bec58f5cd74',
    client_secret: 'bb14317e485db9a408465da9eac80af12e340ad9',
  },
})
gitment.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://waterlin.cn"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/more/"><!--more--></a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/BackEnd/">BackEnd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/FontEnd/">FontEnd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Server/">Server</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tool/">Tool</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/CSS/" style="font-size: 15px;">CSS</a> <a href="/tags/blog/" style="font-size: 15px;">blog</a> <a href="/tags/Algorithm/" style="font-size: 15px;">Algorithm</a> <a href="/tags/Data-struct/" style="font-size: 15px;">Data struct</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/jQuery/" style="font-size: 15px;">jQuery</a> <a href="/tags/BFC/" style="font-size: 15px;">BFC</a> <a href="/tags/HTML5/" style="font-size: 15px;">HTML5</a> <a href="/tags/Sass/" style="font-size: 15px;">Sass</a> <a href="/tags/Browser/" style="font-size: 15px;">Browser</a> <a href="/tags/HTTP/" style="font-size: 15px;">HTTP</a> <a href="/tags/node/" style="font-size: 15px;">node</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/CSS3/" style="font-size: 15px;">CSS3</a> <a href="/tags/ES6/" style="font-size: 15px;">ES6</a> <a href="/tags/Blog/" style="font-size: 15px;">Blog</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/汇编/" style="font-size: 15px;">汇编</a> <a href="/tags/Vue/" style="font-size: 15px;">Vue</a> <a href="/tags/MongoDB/" style="font-size: 15px;">MongoDB</a> <a href="/tags/服务器/" style="font-size: 15px;">服务器</a> <a href="/tags/转载/" style="font-size: 15px;">转载</a> <a href="/tags/RegExp/" style="font-size: 15px;">RegExp</a> <a href="/tags/IFE/" style="font-size: 15px;">IFE</a> <a href="/tags/VSCode/" style="font-size: 15px;">VSCode</a> <a href="/tags/Electron/" style="font-size: 15px;">Electron</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/10/22/离散化求矩形的并/">离散化求矩形的并</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/11/underscore源码学习（八）/">underscore源码学习（八）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/29/underscore源码学习（七）/">underscore源码学习（七）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/27/underscore源码学习（六）/">underscore源码学习（六）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/26/underscore源码学习（五）/">underscore源码学习（五）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/22/underscore源码学习（四）/">underscore源码学习（四）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/19/underscore源码学习（三）/">underscore源码学习（三）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/17/underscore源码学习（二）/">underscore源码学习（二）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/15/underscore源码学习（一）/">underscore源码学习（一）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/22/JavaScript-Sorting-Algorithm/">JavaScript Sorting Algorithm</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://blog.lxstart.net/" title="x-cold" target="_blank">x-cold</a><ul></ul><a href="http://www.cnblogs.com/liuweimingcprogram" title="SCAU_L" target="_blank">SCAU_L</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2016-2017 <a href="/." rel="nofollow">WaterBlog.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" color="0,0,0" opacity="0.5" zIndex="-2" count="50" src="//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script><script type="text/javascript" src="/js/background-canvas.js?v=1.0.0"></script></div></body></html>