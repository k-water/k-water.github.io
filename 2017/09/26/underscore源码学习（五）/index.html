<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="A contented mind is a perpetual feast."><title>underscore源码学习（五） | WaterBlog</title><link rel="stylesheet" type="text/css" href="/css/style.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">underscore源码学习（五）</h1><a id="logo" href="/.">WaterBlog</a><p class="description">WaterGayGay的博客</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/collection/"><i class="fa fa-bookmark"> 收藏</i></a><a href="/history/"><i class="fa fa-book"> 历史</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">underscore源码学习（五）</h1><div class="post-meta">Sep 26, 2017</div><div class="post-content"><p>之前前四篇讲完了underscore中关于集合的部分，顺着源码的顺序读下来，接下来继续其中关于数组<code>Array</code>的部分。</p>
<h3 id="数组定位"><a href="#数组定位" class="headerlink" title="数组定位"></a>数组定位</h3><h4 id="inital"><a href="#inital" class="headerlink" title="_.inital"></a>_.inital</h4><p><code>_.inital</code>函数，获取数组<code>Array</code>除了最后<code>n</code>个元素以外的元素，如果没有传入<code>n</code>，则返回除最后一个元素之外的所有元素。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * @param array</div><div class="line"> * @param n</div><div class="line"> */</div><div class="line">_.initial = <span class="function"><span class="keyword">function</span> (<span class="params">array, n, guard</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> slice.call(array, <span class="number">0</span>, <span class="built_in">Math</span>.max(<span class="number">0</span>, array.length - (n == <span class="literal">null</span> || guard ? <span class="number">1</span> : n)))</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>使用用例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">_.inital([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>])</div><div class="line"><span class="comment">// =&gt; [1,2,3,4,5]</span></div><div class="line">_.inital([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>], <span class="number">2</span>)</div><div class="line"><span class="comment">// =&gt; [1,2,3,4]</span></div></pre></td></tr></table></figure></p>
<h4 id="first"><a href="#first" class="headerlink" title="_.first"></a>_.first</h4><p><code>_.first</code>函数获取数组的前<code>n</code>个元素，相当于<code>_.inital(array, array.length - n)</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * @param array</div><div class="line"> * @param n</div><div class="line"> */</div><div class="line">_.first = _.head = _.take = <span class="function"><span class="keyword">function</span> (<span class="params">array, n, guard</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (array == <span class="literal">null</span>) <span class="keyword">return</span> <span class="keyword">void</span> <span class="number">0</span></div><div class="line">  <span class="keyword">if</span> (n == <span class="literal">null</span> || guard) <span class="keyword">return</span> array[<span class="number">0</span>]</div><div class="line">  <span class="keyword">return</span> _.initial(array, array.length - n)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="rest"><a href="#rest" class="headerlink" title="_.rest"></a>_.rest</h4><p><code>_.rest</code>函数返回除了前面<code>n</code>个元素之外的所有元素，也是基于<code>Array.prototype.slice</code>，并对<code>n</code>作了封装。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * @param array</div><div class="line"> * @param n</div><div class="line"> */</div><div class="line">_.rest = _.tail = _.drop = <span class="function"><span class="keyword">function</span> (<span class="params">array, n, guard</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> slice.call(array, n == <span class="literal">null</span> || guard ? <span class="number">1</span> : n)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="last"><a href="#last" class="headerlink" title="_.last"></a>_.last</h4><p><code>_.last</code>函数返回数组的后面<code>n</code>个元素。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">_.last = <span class="function"><span class="keyword">function</span> (<span class="params">array, n, guard</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (array == <span class="literal">null</span>) <span class="keyword">return</span> <span class="keyword">void</span> <span class="number">0</span></div><div class="line">  <span class="keyword">if</span> (n == <span class="literal">null</span> || guard) <span class="keyword">return</span> array[array.length - <span class="number">1</span>]</div><div class="line">  <span class="keyword">return</span> _.rest(array, <span class="built_in">Math</span>.max(<span class="number">0</span>, array.length - n))</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="数组扁平化"><a href="#数组扁平化" class="headerlink" title="数组扁平化"></a>数组扁平化</h3><p> 有时候我们会遇到这样 的一个需求，将一个数组扁平化，扁平化是什么意思呢？就是一个数组里面嵌套了多个数组，将这个数组展开，变成一个新的数组。看以下例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> arr = [[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[<span class="number">1</span>,<span class="number">2</span>,[<span class="number">3</span>]]]]</div><div class="line">=&gt; <span class="comment">//[1,2,3,1,2,3,1,2,3]</span></div></pre></td></tr></table></figure></p>
<p>underscore为我们提供这样一个功能，看看他怎么实现的。</p>
<h4 id="flatten"><a href="#flatten" class="headerlink" title="_.flatten"></a>_.flatten</h4><p><code>_.flatten</code>函数的功能是对一个数组进行展开，也就是扁平化，可以展开一级，也可以递归全部展开。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * @param array 待展开数组</div><div class="line"> * @param shallow 浅展开还是深展开 若shallow为true 则数组只展开一层</div><div class="line"> */</div><div class="line">_.flatten = <span class="function"><span class="keyword">function</span>(<span class="params">array, shallow</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> flatten(array, shallow, <span class="literal">false</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>_.flatten</code>函数是基于函数<code>flatten</code>函数实现的<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * </div><div class="line"> * @param &#123;array&#125; input 待展开数组</div><div class="line"> * @param &#123;boolean&#125; shallow 是否深展开</div><div class="line"> * @param &#123;string&#125; strict 严格模式下 input必须是数组</div><div class="line"> * @param &#123;number&#125; startIndex 开始下标</div><div class="line"> */</div><div class="line"><span class="keyword">var</span> flatten = <span class="function"><span class="keyword">function</span> (<span class="params">input, shallow, strict, startIndex</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> output = [],</div><div class="line">    idx = <span class="number">0</span></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = startIndex || <span class="number">0</span>, length = getLength(input); i &lt; length; i++) &#123;</div><div class="line">    <span class="keyword">var</span> value = input[i]</div><div class="line">    <span class="keyword">if</span> (isArrayLike(value) &amp;&amp; (_.isArray(value) || _.isArguments(value))) &#123;</div><div class="line">      <span class="comment">// shallow为false 则递归 深入展开</span></div><div class="line">      <span class="keyword">if</span> (!shallow) value = flatten(value, shallow, strict)</div><div class="line">      <span class="keyword">var</span> j = <span class="number">0</span>,</div><div class="line">        len = value.length</div><div class="line">      output.length += len</div><div class="line">      <span class="keyword">while</span> (j &lt; len) &#123;</div><div class="line">        output[idx++] = value[j++]</div><div class="line">      &#125;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!strict) &#123;</div><div class="line">      <span class="comment">//如果不是严格模式 value可以不是数组</span></div><div class="line">      output[idx++] = value</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> output</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>可以看到<code>flatten</code>实现思路是先创建一个新的数组，再遍历传入的数组，把遍历的值赋值到<code>output</code>数组中，最后返回<code>output</code>数组，其中还有两处处理，如果是深入展开，则递归<code>flatten</code>函数，如果是在严格模式下，则<code>input</code>必须是数组类型。<br>使用用例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 指定了严格模式</span></div><div class="line">flatten([<span class="number">1</span>, [<span class="number">2</span>], [<span class="number">3</span>, [[<span class="number">4</span>]]], &#123;name: <span class="string">'water'</span>&#125;], <span class="literal">true</span>, <span class="literal">true</span>)</div><div class="line"><span class="comment">// =&gt; [1, 2, 3, [4]]</span></div><div class="line"></div><div class="line"><span class="comment">// 未指定严格模式</span></div><div class="line">flatten([<span class="number">1</span>, [<span class="number">2</span>], [<span class="number">3</span>, [[<span class="number">4</span>]]], &#123;name: <span class="string">'water'</span>&#125;], <span class="literal">true</span>, <span class="literal">false</span>);</div><div class="line"><span class="comment">// =&gt; [1, 2, 3, [4], &#123;name: 'water'&#125;]</span></div></pre></td></tr></table></figure></p>
<p>在上面的<code>flatten</code>函数中还有一个<code>_.isArguments</code>函数，顾名思义，这个函数的功能是判断一个对象是否是参数<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// IE9以下, 对于对象是否是参数, 需要通过判断该对象是否含有callee属性进行判断</span></div><div class="line"><span class="keyword">if</span> (!_.isArguments(<span class="built_in">arguments</span>)) &#123;</div><div class="line">  <span class="comment">// 判断obj是否是arguments</span></div><div class="line">  <span class="comment">// 只有arguments才会有callee属性</span></div><div class="line">  _.isArguments = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> _.has(obj, <span class="string">'callee'</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 判断对象是否具有属性key</div><div class="line"> * @param &#123;object&#125; obj</div><div class="line"> * @param &#123;string&#125; key</div><div class="line"> */</div><div class="line">_.has = <span class="function"><span class="keyword">function</span> (<span class="params">obj, key</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> obj != <span class="literal">null</span> &amp;&amp; hasOwnProperty.call(obj, key)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="数组运算"><a href="#数组运算" class="headerlink" title="数组运算"></a>数组运算</h3><p>数组运算也是我们平常常见的需求，其中包括了</p>
<ul>
<li>数组去重</li>
<li>求数组的并集</li>
<li>求数组的交集</li>
<li>求数组的差集</li>
</ul>
<h4 id="uniq"><a href="#uniq" class="headerlink" title="_.uniq"></a>_.uniq</h4><p><code>_.uniq</code>函数实现了一个数组去重的方法，根据<code>iteratee</code>提供的标准进行去重，如果<code>isSorted</code>为<code>true</code>，则可提高去重效率。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 返回去重后的副本</div><div class="line"> * @param array 待去重数组</div><div class="line"> * @param isSorted 数组是否有序 如果该参数设置为true 则可提高去重效率</div><div class="line"> * @param iteratee 比较函数 默认使用===</div><div class="line"> * @param context 执行上下文</div><div class="line"> */</div><div class="line">_.uniq = _.unique = <span class="function"><span class="keyword">function</span> (<span class="params">array, isSorted, iteratee, context</span>) </span>&#123;</div><div class="line">  <span class="comment">// 如果第二个参数不是Boolean 则应当理解为比较函数 并且数组无序</span></div><div class="line">  <span class="keyword">if</span> (!_.isBoolean(isSorted)) &#123;</div><div class="line">    context = iteratee</div><div class="line">    iteratee = isSorted</div><div class="line">    isSorted = <span class="literal">false</span></div><div class="line">  &#125;</div><div class="line">  <span class="keyword">if</span> (iteratee != <span class="literal">null</span>) iteratee = cb(iteratee, context)</div><div class="line">  <span class="keyword">var</span> result = []</div><div class="line">  <span class="keyword">var</span> seen = [] <span class="comment">// 标识数组</span></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, length = genLength(array); i &lt; length; i++) &#123;</div><div class="line">    <span class="keyword">var</span> value = array[i],</div><div class="line">      computed = iteratee ? iteratee(value, i, array) : value</div><div class="line">    <span class="keyword">if</span> (isSorted) &#123;</div><div class="line">      <span class="comment">// 若数组有序 则seen只需反映最近一次见到的元素</span></div><div class="line">      <span class="comment">// !i 数组的第一个元素</span></div><div class="line">      <span class="keyword">if</span> (!i || seen !== computed) result.push(value)</div><div class="line">      seen = computed</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (iteratee) &#123;</div><div class="line">      <span class="comment">// 如果尚未排序, 且存在比较函数, 亦即不能直接通过===判断</span></div><div class="line">      <span class="comment">// 此时需要借助于seen这个辅助数组存储计算后的数组元素</span></div><div class="line">      <span class="keyword">if</span> (!_.contains(seen, computed)) &#123;</div><div class="line">        seen.push(computed)</div><div class="line">        result.push(value)</div><div class="line">      &#125;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!_.contains(result, value)) &#123;</div><div class="line">      <span class="comment">// 否则直接通过contains进行判断</span></div><div class="line">      result.push(value)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> result</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>使用用例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">_.uniq([<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>])</div><div class="line"><span class="comment">// =&gt; [1,2,3]</span></div><div class="line">_.unique([&#123; age: <span class="number">20</span>, name: <span class="string">'water'</span> &#125;, &#123; age: <span class="number">20</span>, name: <span class="string">'lzb'</span> &#125;, &#123; age:<span class="number">15</span>, name: <span class="string">'water'</span> &#125;], <span class="string">'age'</span>]);</div><div class="line"><span class="comment">// =&gt; [&#123;age: 20, name:"water"&#125;, &#123;age:15, name: "water"&#125;]</span></div></pre></td></tr></table></figure></p>
<h4 id="union"><a href="#union" class="headerlink" title="_.union"></a>_.union</h4><p><code>_.union</code>函数的功能是对数组求并集。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">_.union = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> _.uniq(flatten(<span class="built_in">arguments</span>, <span class="literal">true</span>, <span class="literal">true</span>))</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>_.union</code>函数的代码非常简单，调用了<code>_.uniq</code>和<code>flatten</code>函数，先对传入的参数进行<code>浅展开</code>，再对展开的数组进行去重，得到数组的并集。</p>
<h4 id="intersection"><a href="#intersection" class="headerlink" title="_.intersection"></a>_.intersection</h4><p><code>_.intersection</code>函数求取数组的交集，思路是遍历数组的第一个的元素，在之后的数组中寻找是否有此元素，有则放入结果 数组。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 获得数组交集</div><div class="line"> * @param array</div><div class="line"> */</div><div class="line">_.intersection = <span class="function"><span class="keyword">function</span> (<span class="params">array</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> result = []</div><div class="line">  <span class="keyword">var</span> argsLength = <span class="built_in">arguments</span>.length</div><div class="line">  <span class="comment">// 遍历第一个数组</span></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, length = getLength(array); i &lt; length; i++) &#123;</div><div class="line">    <span class="keyword">var</span> item = array[i]</div><div class="line">    <span class="comment">// 若结果数组已包含此元素 跳过此次遍历</span></div><div class="line">    <span class="keyword">if</span> (_.contians(result, item)) <span class="keyword">continue</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">1</span>; j &lt; argsLength; j++) &#123;</div><div class="line">      <span class="comment">// 如果后面的数组都没有item 则item不是数组的交集</span></div><div class="line">      <span class="keyword">if</span> (!_.contains(<span class="built_in">arguments</span>[j], item)) <span class="keyword">break</span></div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 否则 item 就是数组的交集 </span></div><div class="line">    <span class="keyword">if</span> (j === argsLength) result.push(item)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>使用用例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">_.intersection([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">101</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">10</span>], [<span class="number">2</span>, <span class="number">1</span>]);</div><div class="line">=&gt; [<span class="number">1</span>, <span class="number">2</span>]</div></pre></td></tr></table></figure></p>
<h4 id="difference"><a href="#difference" class="headerlink" title="_.difference"></a>_.difference</h4><p><code>_.difference</code>求数组的差集，思路是令剩余的数组为<code>rest</code>，遍历第一个数组<code>array</code>,保留数组中<code>array</code>中存在，<code>rest</code>不存在的值。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 计算数组的差值 返回第一个数组中存在 其中数组都不存在的元素</div><div class="line"> * @param array</div><div class="line"> */</div><div class="line">_.difference = <span class="function"><span class="keyword">function</span> (<span class="params">array</span>) </span>&#123;</div><div class="line">  <span class="comment">// 先展开剩余数组为rest数组</span></div><div class="line">  <span class="keyword">var</span> rest = flatten(<span class="built_in">arguments</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="number">1</span>)</div><div class="line">  <span class="comment">// 遍历array 过滤掉array中存在于rest数组的元素</span></div><div class="line">  <span class="keyword">return</span> _.filter(array, <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> !_.contains(rest, value)</div><div class="line">  &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>使用用例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">_.difference([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], [<span class="number">5</span>, <span class="number">2</span>, <span class="number">10</span>]);</div><div class="line">=&gt; [<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>]</div></pre></td></tr></table></figure></p>
<h4 id="unzip"><a href="#unzip" class="headerlink" title="_.unzip"></a>_.unzip</h4><p><code>_.unzip</code>顾名思义解压数组，按照官方文档的意思是，假设我们有三个数组</p>
<ul>
<li><code>name</code> :  <code>[&#39;water&#39;, &#39;lzb&#39;]</code></li>
<li><code>age</code> : <code>[20, 18]</code></li>
<li><code>jobs</code> : <code>[&#39;stu&#39;, &#39;worker&#39;]</code><br>它们构成了一个新的数组<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> infos = [name, age, jobs]</div></pre></td></tr></table></figure>
</li>
</ul>
<p>数组的解压就是多个数组的对应数组抽离出来，形成一个新的数组<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[[<span class="string">'water'</span>, <span class="number">20</span>, <span class="string">'stu'</span>], [<span class="string">'lzb'</span>, <span class="number">18</span>, <span class="string">'worker'</span>]]</div></pre></td></tr></table></figure></p>
<p><code>_.unzip</code>实现的思路是先创建一个定长的数组，然后遍历，利用<code>_.pluck</code>函数取出对应位置的值放入到<code>result</code>数组中，最后返回。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 给定若干数组 每个数组对应位置的元素提取出来放入新的分组 最后合并这些分组</div><div class="line"> * @param array</div><div class="line"> */</div><div class="line">_.unzip = <span class="function"><span class="keyword">function</span> (<span class="params">array</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> length = array &amp;&amp; _.max(array, getLength).length || <span class="number">0</span></div><div class="line">  <span class="keyword">var</span> result = <span class="built_in">Array</span>(length)</div><div class="line"></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> index = <span class="number">0</span>; index &lt; length; index++) &#123;</div><div class="line">    result[index] = _.pluck(array, index)</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> result</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="zip"><a href="#zip" class="headerlink" title="_.zip"></a>_.zip</h4><p><code>_.zip</code>函数功能跟<code>_.unzip</code>相反。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">_.zip = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> _.unzip(<span class="built_in">arguments</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="辅助方法"><a href="#辅助方法" class="headerlink" title="辅助方法"></a>辅助方法</h3><h4 id="object"><a href="#object" class="headerlink" title="_.object"></a>_.object</h4><p><code>_.object(list, values)</code>函数将<code>list</code>转换为对象<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">_.object = <span class="function"><span class="keyword">function</span> (<span class="params">list, values</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> result = &#123;&#125;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, length = getLength(list); i &lt; length; i++) &#123;</div><div class="line">    <span class="keyword">if</span> (values) &#123;</div><div class="line">      result[list[i]] = values[i]</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      result[list[i][<span class="number">0</span>]] = list[i][<span class="number">1</span>]</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> result</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>看源码发现，根据传入的参数形式不同，有两种转换方法</p>
<ul>
<li><p>若没有传入<code>values</code>，则认为<code>list</code>的形式为对应的<code>key-value</code>值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> list = [[<span class="string">'water'</span>, <span class="number">20</span>], [<span class="string">'lzb'</span>, <span class="number">20</span>]];</div></pre></td></tr></table></figure>
</li>
<li><p>若传入了<code>values</code>，则视<code>list</code>为key值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> list = [<span class="string">'water'</span>,<span class="string">'lzb'</span>];</div><div class="line"><span class="keyword">var</span> values = [<span class="number">20</span>, <span class="number">20</span>];</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="range"><a href="#range" class="headerlink" title="_.range"></a>_.range</h4><p><code>_.range</code>函数生成一个<code>[start, n]</code>的序列，可设置步长<code>step</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * @param start 起始位置</div><div class="line"> * @param stop 结束位置</div><div class="line"> * @param step 步长</div><div class="line"> */</div><div class="line">_.range = <span class="function"><span class="keyword">function</span> (<span class="params">start, stop, step</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (stop == <span class="literal">null</span>) &#123;</div><div class="line">    stop = start || <span class="number">0</span></div><div class="line">    start = <span class="number">0</span></div><div class="line">  &#125;</div><div class="line">  step = step || <span class="number">1</span></div><div class="line">  <span class="keyword">var</span> length = <span class="built_in">Math</span>.max(<span class="built_in">Math</span>.cell((stop - start) / step), <span class="number">0</span>)</div><div class="line">  <span class="keyword">var</span> range = <span class="built_in">Array</span>(length)</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> idx = <span class="number">0</span>; idx &lt; length; idx++, start += step) &#123;</div><div class="line">    range[idx] = start</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> range</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>使用用例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">_.range(<span class="number">10</span>);</div><div class="line">=&gt; [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</div><div class="line">_.range(<span class="number">1</span>, <span class="number">11</span>);</div><div class="line">=&gt; [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]</div><div class="line">_.range(<span class="number">0</span>, <span class="number">30</span>, <span class="number">5</span>);</div><div class="line">=&gt; [<span class="number">0</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">20</span>, <span class="number">25</span>]</div><div class="line">_.range(<span class="number">0</span>, <span class="number">-10</span>, <span class="number">-1</span>);</div><div class="line">=&gt; [<span class="number">0</span>, <span class="number">-1</span>, <span class="number">-2</span>, <span class="number">-3</span>, <span class="number">-4</span>, <span class="number">-5</span>, <span class="number">-6</span>, <span class="number">-7</span>, <span class="number">-8</span>, <span class="number">-9</span>]</div><div class="line">_.range(<span class="number">0</span>);</div><div class="line">=&gt; []</div></pre></td></tr></table></figure></p>
</div><div class="tags"><a href="/tags/JavaScript/">JavaScript</a></div><div class="post-nav"><a href="/2017/09/27/underscore源码学习（六）/" class="pre">underscore源码学习（六）</a><a href="/2017/09/22/underscore源码学习（四）/" class="next">underscore源码学习（四）</a></div><div id="container"></div><link rel="stylesheet" href="/css/default.css?v=1.0.0"><script src="/js/gitment.browser.js?v=1.0.0"></script><script>var gitment = new Gitment({
  owner: 'k-water',
  repo: 'k-water.github.io',
  oauth: {
    client_id: 'b80d9a577bec58f5cd74',
    client_secret: 'bb14317e485db9a408465da9eac80af12e340ad9',
  },
})
gitment.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://waterlin.cn"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/more/"><!--more--></a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/BackEnd/">BackEnd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/FontEnd/">FontEnd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Server/">Server</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tool/">Tool</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/CSS/" style="font-size: 15px;">CSS</a> <a href="/tags/jQuery/" style="font-size: 15px;">jQuery</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/Sass/" style="font-size: 15px;">Sass</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/blog/" style="font-size: 15px;">blog</a> <a href="/tags/Algorithm/" style="font-size: 15px;">Algorithm</a> <a href="/tags/Data-struct/" style="font-size: 15px;">Data struct</a> <a href="/tags/BFC/" style="font-size: 15px;">BFC</a> <a href="/tags/Browser/" style="font-size: 15px;">Browser</a> <a href="/tags/HTTP/" style="font-size: 15px;">HTTP</a> <a href="/tags/node/" style="font-size: 15px;">node</a> <a href="/tags/HTML5/" style="font-size: 15px;">HTML5</a> <a href="/tags/CSS3/" style="font-size: 15px;">CSS3</a> <a href="/tags/ES6/" style="font-size: 15px;">ES6</a> <a href="/tags/Blog/" style="font-size: 15px;">Blog</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Vue/" style="font-size: 15px;">Vue</a> <a href="/tags/MongoDB/" style="font-size: 15px;">MongoDB</a> <a href="/tags/服务器/" style="font-size: 15px;">服务器</a> <a href="/tags/转载/" style="font-size: 15px;">转载</a> <a href="/tags/IFE/" style="font-size: 15px;">IFE</a> <a href="/tags/汇编/" style="font-size: 15px;">汇编</a> <a href="/tags/VSCode/" style="font-size: 15px;">VSCode</a> <a href="/tags/Electron/" style="font-size: 15px;">Electron</a> <a href="/tags/RegExp/" style="font-size: 15px;">RegExp</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/10/22/离散化求矩形的并/">离散化求矩形的并</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/11/underscore源码学习（八）/">underscore源码学习（八）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/29/underscore源码学习（七）/">underscore源码学习（七）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/27/underscore源码学习（六）/">underscore源码学习（六）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/26/underscore源码学习（五）/">underscore源码学习（五）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/22/underscore源码学习（四）/">underscore源码学习（四）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/19/underscore源码学习（三）/">underscore源码学习（三）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/17/underscore源码学习（二）/">underscore源码学习（二）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/15/underscore源码学习（一）/">underscore源码学习（一）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/22/JavaScript-Sorting-Algorithm/">JavaScript Sorting Algorithm</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://blog.lxstart.net/" title="x-cold" target="_blank">x-cold</a><ul></ul><a href="http://www.cnblogs.com/liuweimingcprogram" title="SCAU_L" target="_blank">SCAU_L</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2016-2017 <a href="/." rel="nofollow">WaterBlog.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" color="0,0,0" opacity="0.5" zIndex="-2" count="50" src="//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script><script type="text/javascript" src="/js/background-canvas.js?v=1.0.0"></script></div></body></html>