<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="A contented mind is a perpetual feast."><title>underscore源码学习（二） | WaterBlog</title><link rel="stylesheet" type="text/css" href="/css/style.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">underscore源码学习（二）</h1><a id="logo" href="/.">WaterBlog</a><p class="description">WaterGayGay的博客</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/collection/"><i class="fa fa-bookmark"> 收藏</i></a><a href="/history/"><i class="fa fa-book"> 历史</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">underscore源码学习（二）</h1><div class="post-meta">Sep 17, 2017</div><div class="post-content"><p>顺着underscore源码的顺序读下来，弄懂了之前underscore的基本结构，接下来看看underscore为我们提供的一些关于<code>集合</code>的API。</p>
<h3 id="迭代"><a href="#迭代" class="headerlink" title="迭代"></a>迭代</h3><p>关于迭代，我们都知道ES5原生方法也提供了迭代函数供我们使用，而在underscore中的迭代则是对原生的迭代函数进行了封装优化升级。在underscore中，迭代的对象不仅仅是数组对象，还支持Array，Object的迭代，对Object的迭代的依据是对象的键值对（key-value），看看 underscore中<code>_.each</code>是如何实现的：<br><a id="more"></a><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * each方法将ES5的forEach换为了函数式表达</div><div class="line"> * @param obj 待迭代集合</div><div class="line"> * @param iteratee 迭代过程中每个被迭代元素的回调函数</div><div class="line"> * @param context 上下文</div><div class="line"> * @example</div><div class="line"> * // 数组迭代</div><div class="line"> * _.each([1, 2, 3], alert);</div><div class="line"> * // 对象迭代</div><div class="line"> * _.each(&#123;one: 1, two: 2, three: 3&#125;, alert);</div><div class="line"> */</div><div class="line">_.each = _.forEach = <span class="function"><span class="keyword">function</span> (<span class="params">obj, iteratee, context</span>) </span>&#123;</div><div class="line">  <span class="comment">//优化回调</span></div><div class="line">  iteratee = optimizeCb(iteratee, context);</div><div class="line">  <span class="keyword">var</span> i, length;</div><div class="line">  <span class="comment">// 判断是数组还是对象</span></div><div class="line">  <span class="keyword">if</span> (isArrayLike(obj)) &#123;</div><div class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>, length = obj.length; i &lt; length; i++) &#123;</div><div class="line">      iteratee(obj[i], i, obj)</div><div class="line">    &#125;</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">var</span> keys = _.keys(obj)</div><div class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>, length = keys.length; i &lt; length; i++) &#123;</div><div class="line">      iteratee(obj[keys[i]], keys[i], obj)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// 返回对象自身 以便于链式调用</span></div><div class="line">  <span class="keyword">return</span> obj</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>看以上源码可知，<code>_.each</code>传入三个参数，主要的是第二个<code>iteratee</code>回调函数，然后再通过<code>optimizeCb</code>优化回调，返回对应的回调(optimizeCb可以查看第一部分)。<br><code>array</code>迭代的是数组的每个元素，传入的三个参数分别为<code>数组的值，对应值的下标，数组本身</code>。<code>Object</code>迭代的元素是对象的每个键值对key-value，传入的参数为<code>对象的key所对应的值，对象的key值，对象本身</code>。</p>
<h3 id="map-reduce"><a href="#map-reduce" class="headerlink" title="map-reduce"></a>map-reduce</h3><p>ES5原生方法也提供map和reduce方法，它们提供了一种对列表操作的思路，是函数式编程重要组成部分。具体map和reduce可以去MDN上查看相关API。</p>
<h4 id="map在underscore中的实现"><a href="#map在underscore中的实现" class="headerlink" title="map在underscore中的实现"></a>map在underscore中的实现</h4><p>它的实现思路是：</p>
<ul>
<li>返回一个新的列表或元素</li>
<li>对列表中的值进行遍历，用指定函数<code>func</code>作用于每个遍历的元素，输出一个新的值放到新的列表中<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">_.map = _.collect = <span class="function"><span class="keyword">function</span>(<span class="params">obj, iteratee, context</span>) </span>&#123;</div><div class="line">  iteratee = cb(iteratee, context)</div><div class="line">  <span class="comment">//考虑数组和对象</span></div><div class="line">  <span class="keyword">var</span> keys = !isArrayLike(obj) &amp;&amp; _.keys(obj),</div><div class="line">      length = (keys || obj).length,</div><div class="line">      results = <span class="built_in">Array</span>(length) <span class="comment">// 初始化定长数组</span></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> index = <span class="number">0</span>; index &lt; length; index++) &#123;</div><div class="line">    <span class="keyword">var</span> currentKey = keys ? keys[index] : index</div><div class="line">    results[index] = iteratee(obj[currentKey], currentKey, obj)</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> results</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>使用用例：<br>对数组使用<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> res = _.map([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>], <span class="function"><span class="keyword">function</span>(<span class="params">elem, index, array</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> elem * <span class="number">2</span></div><div class="line">&#125;)</div><div class="line"><span class="comment">// =&gt; [2,4,6]</span></div></pre></td></tr></table></figure></p>
<p>对对象使用<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line"> name: <span class="string">'lzb'</span>,</div><div class="line"> age: <span class="string">'20'</span>,</div><div class="line"> sex: <span class="string">'male'</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> res = _.map(obj, <span class="function"><span class="keyword">function</span>(<span class="params">value, key, obj</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> key</div><div class="line">&#125;)</div><div class="line"><span class="comment">// =&gt; name age sex</span></div></pre></td></tr></table></figure></p>
<h4 id="reduce在underscore中的实现"><a href="#reduce在underscore中的实现" class="headerlink" title="reduce在underscore中的实现"></a>reduce在underscore中的实现</h4><p>reduce相对于map的实现复杂了一些，underscore首先在外部实现了reduce函数的工厂函数<code>createReduce</code>，这个函数实现了以下功能：</p>
<ul>
<li>区分reduce的开始方向(参数dir)，是从首端开始末端开始</li>
<li>memo记录最新的结果</li>
</ul>
<p>reduce的执行过程大概是：</p>
<ul>
<li>设置一个memo变量缓存当前规约过程的结果</li>
<li>如果用户为初始化memo，则memo的值为序列的第一个值</li>
<li>遍历当前集合，对当前遍历到的元素按传入的<code>func</code>进行规约操作，刷新memo</li>
<li>遍历结束，返回memo</li>
</ul>
<p>createReduce的实现：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * reduce函数的工厂函数, 用于生成一个reducer, 通过参数决定reduce的方向</div><div class="line"> * @param dir 方向 left or right</div><div class="line"> * @returns &#123;function&#125;</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createReduce</span>(<span class="params">dir</span>) </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">iterator</span>(<span class="params">obj, iteratee, memo, keys, index, length</span>) </span>&#123;</div><div class="line">    <span class="keyword">for</span> (; idnex &gt; <span class="number">0</span> &amp;&amp; index &lt; length; index += dir) &#123;</div><div class="line">      <span class="keyword">var</span> currentKey = keys ? keys[index] : index</div><div class="line">      <span class="comment">// memo 用来记录最新的 reduce 结果</span></div><div class="line">      <span class="comment">// 执行 reduce 回调, 刷新当前值</span></div><div class="line">      memo = iteratee(memo, obj[currentKey], currentKey, obj)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="comment">/**</span></div><div class="line">   * @param obj 传入的对象</div><div class="line">   * @param iteratee 回调函数</div><div class="line">   * @param memo 初始化累加器的值</div><div class="line">   * @param context 执行上下文</div><div class="line">   */</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">obj, iteratee, memo, context</span>) </span>&#123;</div><div class="line">    iteratee = optimizeCb(iteratee, context, <span class="number">4</span>)</div><div class="line">    <span class="keyword">var</span> keys = !isArrayLike(obj) &amp;&amp; _.keys(obj),</div><div class="line">      length = (keys || obj).length</div><div class="line">    index = dir &gt; <span class="number">0</span> ? <span class="number">0</span> : length - <span class="number">1</span></div><div class="line">    <span class="comment">// 如果没有传入memo初始值 则从左第一个为初始值 从右则最后一个为初始值</span></div><div class="line">    <span class="keyword">if</span> (<span class="built_in">arguments</span>.length &lt; <span class="number">3</span>) &#123;</div><div class="line">      memo = obj[keys ? keys[index] : index]</div><div class="line">      index += dir</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> iterator(obj, iteratee, memo, keys, index, length)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>最后，underscore暴露了两个供使用的方法<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 由左至右进行规约</span></div><div class="line">_.reduce = _.foldl = _.inject = createReduce(<span class="number">1</span>);</div><div class="line"><span class="comment">// 由右至左进行规约</span></div><div class="line">_.reduceRight = _.foldr = createReduce(<span class="number">-1</span>);</div></pre></td></tr></table></figure></p>
<p>使用用例：<br>对数组使用<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> sum = _.reduce([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>], <span class="function"><span class="keyword">function</span>(<span class="params">prev, current, index, arr</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> prev + current</div><div class="line">&#125;, <span class="number">0</span>)</div><div class="line"><span class="comment">// =&gt; 10</span></div></pre></td></tr></table></figure></p>
<p>对对象使用<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> scores = &#123;</div><div class="line">  english: <span class="number">93</span>,</div><div class="line">  math: <span class="number">88</span>,</div><div class="line">  chinese: <span class="number">100</span></div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> total = _.reduce(scores, <span class="function"><span class="keyword">function</span>(<span class="params">prev, value, key, obj</span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> prev+value;</div><div class="line">&#125;, <span class="number">0</span>);</div><div class="line"><span class="comment">// =&gt; total: 281</span></div></pre></td></tr></table></figure></p>
<h3 id="真值检测函数"><a href="#真值检测函数" class="headerlink" title="真值检测函数"></a>真值检测函数</h3><p>在underscore中，除了提供<code>_.each,_.map._.reduce</code>等函数操作集合，还提供了<code>_.filter, _.reject, _.every, _.some</code>这几个基于逻辑判断的集合操作函数。这些API都依赖于用户提供的真值检测函数来返回对应的结果。<br>在underscore中，真值检测函数的参数被命名为<code>predicate</code>，<code>predicate</code>有断言的意思，非常形象。当然，<code>predicate</code>依旧会通过<code>cb</code>优化。</p>
<h4 id="filter"><a href="#filter" class="headerlink" title="_.filter"></a>_.filter</h4><p>看看<code>_.filter</code>的实现<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 根据真值检测函数 过滤对象 </div><div class="line"> * 检测通过符合条件 保留元素</div><div class="line"> * @param obj</div><div class="line"> * @param predicate</div><div class="line"> * @param context</div><div class="line"> * @example </div><div class="line"> * var evens = _.filter([1, 2, 3, 4, 5, 6], function(num)&#123; return num % 2 == 0; &#125;);</div><div class="line"> * =&gt; [2, 4, 6]</div><div class="line"> */</div><div class="line">_.filter = _.select = <span class="function"><span class="keyword">function</span> (<span class="params">obj, predicate, context</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> results = []</div><div class="line">  <span class="comment">// 优化回调</span></div><div class="line">  predicate = cb(predicate, context)</div><div class="line">  _.each(obj, <span class="function"><span class="keyword">function</span> (<span class="params">value, index, list</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (predicate(value, index, list)) results.push(value)</div><div class="line">  &#125;)</div><div class="line">  <span class="keyword">return</span> results</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>根据传入的元素信息，检测并返回对应boolean值，决定当前元素要被保留。</p>
<h4 id="reject"><a href="#reject" class="headerlink" title="_.reject"></a>_.reject</h4><p>上面的<code>_.filter</code>函数是元素符合检测条件就保留，而<code>_.reject</code>函数则是与<code>_.filter</code>相反的功能<br>我们来看看underscore中<code>_.reject</code>的实现<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * filter的反运算,</div><div class="line"> * 如果真值检测通过, 元素被丢弃</div><div class="line"> */</div><div class="line">_.reject = <span class="function"><span class="keyword">function</span> (<span class="params">obj, predicate, context</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> _.filter(obj, _negate(cb(predicate)), context)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>可以看到，这个函数只有一行代码，非常简短。那么，这其中的<code>_.negate</code>函数又是什么呢？猜测下，<code>negate</code>在英语中有否定的意思，那么跟<code>_.reject</code>的功能就有了一定的联系， 下面看看<code>_.negate</code>的实现<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">_.negate = <span class="function"><span class="keyword">function</span>(<span class="params">predicate</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> !predicate.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>可以看到，<code>_.negate</code>得到了反义<code>predicate</code>的执行结果，减少了大量重复的代码，值得学习。</p>
<h4 id="every"><a href="#every" class="headerlink" title="_.every"></a>_.every</h4><p>迭代对象里的每个元素，只有每个元素都通过真值检测函数，才返回<code>true</code>。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * @param obj</div><div class="line"> * @param predicate</div><div class="line"> * @param context</div><div class="line"> * @example</div><div class="line"> * _.every([true, 1, null, 'yes'], _.identity);</div><div class="line"> * =&gt; false</div><div class="line"> */</div><div class="line">_.every = _.all = <span class="function"><span class="keyword">function</span> (<span class="params">obj, predicate, context</span>) </span>&#123;</div><div class="line">  predicate = cb(predicate, context)</div><div class="line">  <span class="keyword">var</span> keys = !isArrayLike(obj) &amp;&amp; _.keys(obj),</div><div class="line">    length = (keys || obj).length</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> index = <span class="number">0</span>; index &lt; length; index++) &#123;</div><div class="line">    <span class="keyword">var</span> currentKey = keys ? keys[index] : index</div><div class="line">    <span class="keyword">if</span> (!predicate(obj[currentKey], currentKey, obj)) <span class="keyword">return</span> <span class="literal">false</span></div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="literal">true</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="some"><a href="#some" class="headerlink" title="_.some"></a>_.some</h4><p>这个API跟<code>_.every</code>差不多，从英语单词的含义我们也可以猜出它的功能，即迭代对象的所有元素，如果有任意一个通过真值检测，则返回<code>true</code>。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * @param obj</div><div class="line"> * @param predicate</div><div class="line"> * @param context</div><div class="line"> * @example</div><div class="line"> * _.some([null, 0, 'yes', false]);</div><div class="line"> * =&gt; true</div><div class="line"> */</div><div class="line">_.some = _.any = <span class="function"><span class="keyword">function</span> (<span class="params">obj, predicate, context</span>) </span>&#123;</div><div class="line">  predicate = cb(predicate, context)</div><div class="line">  <span class="keyword">var</span> keys = !isArrayLike(obj) &amp;&amp; _.keys(obj),</div><div class="line">    length = (keys || obj).length</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> index = <span class="number">0</span>; index &lt; length; index++) &#123;</div><div class="line">    <span class="keyword">var</span> currentKey = keys ? keys[index] : index</div><div class="line">    <span class="keyword">if</span> (predicate(obj[currentKey], currentKey, obj)) <span class="keyword">return</span> <span class="literal">true</span></div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="literal">false</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="contains"><a href="#contains" class="headerlink" title="_.contains"></a>_.contains</h4><p><code>_.contains</code>函数的功能是检测一个对象或数组是否包含指定的某个元素。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * @param obj 待检测对象</div><div class="line"> * @param item 指定的元素</div><div class="line"> * @param fromIndex 从哪个位置开始找</div><div class="line"> * @param guard</div><div class="line"> * @example</div><div class="line"> * _.contains([1,2,3], 3)</div><div class="line"> * =&gt; true</div><div class="line"> */</div><div class="line">_.contains = _.includes = _.include = <span class="function"><span class="keyword">function</span> (<span class="params">obj, item, fromIndex, guard</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (!isArrayLike(obj)) obj = _.values(obj)</div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> fromIndex != <span class="string">'number'</span> || guard) fromIndex = <span class="number">0</span></div><div class="line">  <span class="keyword">return</span> _.indexOf(obj, item.fromIndex) &gt;= <span class="number">0</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>从代码上看，还是比较容易理解的，这里主要用到了underscore内部提供的两个函数，<code>_.values</code>和<code>_.indexOf</code>，从名字上我们也可以猜出它们之间的功能，如果传入的对象，则取出该对象所有的值，然后再进行查找比较，看看<code>_values</code>的实现：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 获得一个对象的所有value</div><div class="line"> * @param obj 对象</div><div class="line"> * @returns &#123;Array&#125; 值序列</div><div class="line"> * @example</div><div class="line"> * _.values(&#123;one: 1, two: 2, three: 3&#125;);</div><div class="line"> * // =&gt; [1, 2, 3]</div><div class="line"> */</div><div class="line">_.values = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> keys = _.keys(obj)</div><div class="line">  <span class="keyword">var</span> length = keys.length</div><div class="line">  <span class="keyword">var</span> values = <span class="built_in">Array</span>(length)</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</div><div class="line">    values[i] = obj[keys[i]]</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> values</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>而<code>_.indexOf</code>的实现就比较复杂了，这是underscore中提供的关于查找的API，详细介绍将在下一篇总结写出。</p>
</div><div class="tags"><a href="/tags/JavaScript/">JavaScript</a></div><div class="post-nav"><a href="/2017/09/19/underscore源码学习（三）/" class="pre">underscore源码学习（三）</a><a href="/2017/09/15/underscore源码学习（一）/" class="next">underscore源码学习（一）</a></div><div id="container"></div><link rel="stylesheet" href="/css/default.css?v=1.0.0"><script src="/js/gitment.browser.js?v=1.0.0"></script><script>var gitment = new Gitment({
  owner: 'k-water',
  repo: 'k-water.github.io',
  oauth: {
    client_id: 'b80d9a577bec58f5cd74',
    client_secret: 'bb14317e485db9a408465da9eac80af12e340ad9',
  },
})
gitment.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://waterlin.cn"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/more/"><!--more--></a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/BackEnd/">BackEnd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/FontEnd/">FontEnd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Server/">Server</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tool/">Tool</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/node/" style="font-size: 15px;">node</a> <a href="/tags/HTML5/" style="font-size: 15px;">HTML5</a> <a href="/tags/jQuery/" style="font-size: 15px;">jQuery</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/blog/" style="font-size: 15px;">blog</a> <a href="/tags/Algorithm/" style="font-size: 15px;">Algorithm</a> <a href="/tags/Data-struct/" style="font-size: 15px;">Data struct</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/Sass/" style="font-size: 15px;">Sass</a> <a href="/tags/Browser/" style="font-size: 15px;">Browser</a> <a href="/tags/HTTP/" style="font-size: 15px;">HTTP</a> <a href="/tags/BFC/" style="font-size: 15px;">BFC</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/CSS/" style="font-size: 15px;">CSS</a> <a href="/tags/CSS3/" style="font-size: 15px;">CSS3</a> <a href="/tags/ES6/" style="font-size: 15px;">ES6</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Blog/" style="font-size: 15px;">Blog</a> <a href="/tags/Vue/" style="font-size: 15px;">Vue</a> <a href="/tags/服务器/" style="font-size: 15px;">服务器</a> <a href="/tags/转载/" style="font-size: 15px;">转载</a> <a href="/tags/MongoDB/" style="font-size: 15px;">MongoDB</a> <a href="/tags/汇编/" style="font-size: 15px;">汇编</a> <a href="/tags/IFE/" style="font-size: 15px;">IFE</a> <a href="/tags/VSCode/" style="font-size: 15px;">VSCode</a> <a href="/tags/Electron/" style="font-size: 15px;">Electron</a> <a href="/tags/RegExp/" style="font-size: 15px;">RegExp</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/10/11/underscore源码学习（八）/">underscore源码学习（八）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/29/underscore源码学习（七）/">underscore源码学习（七）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/27/underscore源码学习（六）/">underscore源码学习（六）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/26/underscore源码学习（五）/">underscore源码学习（五）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/22/underscore源码学习（四）/">underscore源码学习（四）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/19/underscore源码学习（三）/">underscore源码学习（三）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/17/underscore源码学习（二）/">underscore源码学习（二）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/15/underscore源码学习（一）/">underscore源码学习（一）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/22/JavaScript-Sorting-Algorithm/">JavaScript Sorting Algorithm</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/18/在Vue中使用第三方库/">在Vue中使用第三方库</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://blog.lxstart.net/" title="x-cold" target="_blank">x-cold</a><ul></ul><a href="http://www.cnblogs.com/liuweimingcprogram" title="SCAU_L" target="_blank">SCAU_L</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2016-2017 <a href="/." rel="nofollow">WaterBlog.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" color="0,0,0" opacity="0.5" zIndex="-2" count="50" src="//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script><script type="text/javascript" src="/js/background-canvas.js?v=1.0.0"></script></div></body></html>